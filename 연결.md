# ì„¸ì…˜, ì¿ í‚¤

í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ì—°ê²°ì„ ìœ ì§€í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•œë‹¤.

## 20-1. ì„¸ì…˜(Session)ê³¼ ì¿ í‚¤(Cookie)

ì›¹ì„œë¹„ìŠ¤ëŠ” HTTP í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ”ë°, HTTP í”„ë¡œí† ì½œì€ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ê´€ê³„ë¥¼ ìœ ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” íŠ¹ì§•ì´ ìˆë‹¤.(=> Conncetionless Protocol)

â“ì„œë²„ì— ìš”ì²­ì„ í•˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì—¬ëŸ¬ê°œì¸ë° ëª¨ë‘ ìœ ì§€í•œë‹¤ë©´ ë¶€í•˜ê°€ ê±¸ë¦´ ê²ƒì´ë‹¤. (ì„œë²„ì˜ ìì›ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê¸° ìœ„í•´ì„œ)

ì´ëŸ¬í•œ Conncetionless Protocolì˜ ë¶ˆí¸í•¨ì„ í•´ê²°í•˜ê¸° ìœ„í•´ ì„¸ì…˜ê³¼ ì¿ í‚¤ë¥¼ ì‚¬ìš©í•œë‹¤.

ì„¸ì…˜ê³¼ ì¿ í‚¤ëŠ” í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ì—°ê²° ìƒíƒœë¥¼ ìœ ì§€í•´ì£¼ëŠ” ë°©ë²•ìœ¼ë¡œ, `ì„¸ì…˜`ì€ `ì„œë²„ì—ì„œ ì—°ê²° ì •ë³´ë¥¼ ê´€ë¦¬`í•˜ëŠ” ë°˜ë©´ `ì¿ í‚¤`ëŠ” `í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì—°ê²° ì •ë³´ë¥¼ ê´€ë¦¬`í•˜ëŠ”ë° ì°¨ì´ê°€ ìˆë‹¤.

## 20-2. HttpServletRequestë¥¼ ì´ìš©í•œ ì„¸ì…˜ ì‚¬ìš©

EX) ë¡œê·¸ì¸ ìœ ì§€ì™€ ë¡œê·¸ì•„ì›ƒ

ìŠ¤í”„ë§ MVCì—ì„œ HttpServletRequestë¥¼ ì´ìš©í•´ì„œ ì„¸ì…˜ì„ ì´ìš©í•˜ë ¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì†Œë“œì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ HttpServletRequestë¥¼ ë°›ìœ¼ë©´ ëœë‹¤.

## 20-3. HttpSesssionì„ ì´ìš©í•œ ì„¸ì…˜ ì‚¬ìš©

HttpServletRequestë¥¼ ì´ìš©í•œ ë°©ë²•ê³¼ ë¹„ìŠ·í•˜ë‹¤. ë‹¨ì§€ ì„¸ì…˜ê°ì²´ë¥¼ ì–»ëŠ” ë°©ë²•ì— ì°¨ì´ê°€ ìˆì„ ë¿ì´ë‹¤.

> HttpServletRequest

íŒŒë¼ë¯¸í„°ë¡œ HttpServletRequestë¥¼ ë°›ì€ í›„ getSession()ìœ¼ë¡œ ì„¸ì…˜ ì–»ëŠ”ë‹¤.

> HttpSesssion

íŒŒë¼ë¯¸í„°ë¡œ HttpSesssionì„ ë°›ì•„ ì„¸ì…˜ ì‚¬ìš©.

## 20-4. ì„¸ì…˜ ì‚­ì œ

ì£¼ë¡œ ë¡œê·¸ì•„ì›ƒ ë˜ëŠ” íšŒì› íƒˆí‡´ ë“±ì— ì‚¬ìš©ëœë‹¤.
~~~
session.invalidate();
~~~

## 20-5. ì„¸ì…˜ ì£¼ìš” ë©”ì†Œë“œ ë° í”Œë¡œì–´


|ì„¸ì…˜ ë©”ì†Œë“œ    |ê¸°ëŠ¥                                   |
|------------|--------------------------------------|
|**getId()**   | ì„¸ì…˜ IDë¥¼ ë°˜í™˜ë‹¤.                        |
|**setAttribute()** | ì„¸ì…˜ ê°ì²´ì— ì†ì„±ì„ ì €ì¥í•œë‹¤.           |
|**getAttribute()** | ì„¸ì…˜ ê°ì²´ì— ì €ì¥ëœ ì†ì„±ì„ ë°˜í™˜í•œë‹¤.      |
|removeAttribute() |ì„¸ì…˜ ê°ì²´ì— ì €ì¥ëœ ì†ì„±ì„ ì œê±°í•œë‹¤.      |
|setMaxInactiveInterval() |ì„¸ì…˜ ê°ì²´ì˜ ìœ ì§€ì‹œê°„ì„ ì„¤ì •í•œë‹¤. |
|getMaxInactiveInterval() |ì„¸ì…˜ ê°ì²´ì˜ ìœ ì§€ì‹œê°„ì„ ë°˜í™˜í•œë‹¤. |
|invalidate() |ì„¸ì…˜ ê°ì²´ì˜ ëª¨ë“  ì •ë³´ë¥¼ ì‚­ì œí•œë‹¤.            |

## 20-6. ì¿ í‚¤(Cookie)

mallMain() ì—ì„œ ì¿ í‚¤ë¥¼ ìƒì„±í•˜ê³ , íŒŒë¼ë¯¸í„°ë¡œ ë°›ì€ HttpServletResponse ì— ì¿ í‚¤ë¥¼ ë‹´ê³  ìˆë‹¤.

ì¿ í‚¤ë¥¼ ìƒì„±í•  ë•ŒëŠ” ìƒì„±ìì— ë‘ ê°œì˜ íŒŒë¼ë¯¸í„°ë¥¼ ë„£ì–´ì£¼ëŠ”ë° ì²«ë²ˆì§¸ëŠ” ì¿ í‚¤ ì´ë¦„ì„ ë„£ì–´ì£¼ê³  ë‘ ë²ˆì§¸ëŠ” ì¿ í‚¤ ê°’ì„ ë„£ì•„ì¤€ë‹¤.
~~~
@RequestMapping("/main")
public String mallMain(Mall mall, HttpServletResponse response){
    /* ì¿ í‚¤ ìƒì„± */
    Cookie genderCookie = new Cookie("gender", mall.getGender());
if(mall.isCookieDel()) { 
    genderCookie.setMaxAge(0); mall.setGender(null);
}else{ 
    genderCookie.setMaxAge(60*60*24*30);
} 
response.addCookie(genderCookie);
return "/mall/main"; 
}
~~~


~~~
@RequestMapping("/index")
public String mallIndex(Mall mall,
@CookieValue(value="gender", required=false) Cookie genderCookie, HttpServletRequest request) {
if(genderCookie != null) mall.setGender(genderCookie.getValue());
return "/mall/index"; }
~~~

@CookieValue ì–´ë…¸í…Œì´ì…˜ì˜ value ì†ì„±ì€ ì¿ í‚¤ ì´ë¦„ì„ ë‚˜íƒ€ë‚´ëŠ”ë°, ë§Œì•½ valueì— ëª…ì‹œí•œ ì¿ í‚¤ê°€ ì—†ì„ ê²½ìš° ìµì…‰ì…˜ì´ ë°œìƒí•œë‹¤.
ìµì…‰ì…˜ì„ ë§‰ëŠ” ë°©ë²•ì´ ìˆëŠ”ë°, ë°”ë¡œ required ì†ì„±ì´ë‹¤. Required ì†ì„±ì€ ê¸°ë³¸ê°’ìœ¼ë¡œ trueë¥¼ ê°€ì§€ê³  ìˆëŠ”ë° requiredê°€ trueì¸ ê²½ìš° valueê°’ì— í•´ë‹¹í•˜ëŠ” ì¿ í‚¤ê°€ ì—†ìœ¼ë©´ ìµì…‰ ì…˜ì´ ë°œìƒí•œë‹¤. ë”°ë¼ì„œ `required ì†ì„±ê°’ì„ falseë¡œ ì„¤ì •í•´ì„œ valueê°’ì— í•´ë‹¹í•˜ëŠ” ì¿ í‚¤ê°€ ì—†ì–´ë„ ìµì…‰ì…˜ì´ ë°œìƒí•˜ì§€ ì•Šë„ë¡` í•œë‹¤.

âœ… ì¿ í‚¤ë³´ë‹¤ëŠ” ì„¸ì…˜ì´ ë³´ì•ˆì´ ì¢‹ê¸° ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„œëŠ” ì„¸ì…˜ì„ ë” ë§ì´ ì‚¬ìš©í•œë‹¤.



# ë¦¬ë‹¤ì´ë ‰íŠ¸, ì¸í„°ì…‰íŠ¸

## 21-1. ë¦¬ë‹¤ì´ë ‰íŠ¸(redirect)

- ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë·°ë¥¼ ë¶„ê¸°í•˜ëŠ” ë°©ë²•

ì§€ê¸ˆì˜ í˜ì´ì§€ì—ì„œ íŠ¹ì • í˜ì´ì§€ë¡œ ì „í™˜í•˜ëŠ” ê¸°ëŠ¥. ì˜ˆë¥¼ ë“¤ì–´, íšŒì›ì •ë³´ ìˆ˜ì • ìš”ì²­ í˜ì´ì§€ë¡œ ì§„ì…í–ˆëŠ”ë° íšŒì›ì¸ì¦ì´ ì•ˆë˜ì–´ ìˆì„ ë•Œ ë©”ì¸ í˜ì´ì§€ë¡œ ì „í™˜í•˜ëŠ” ê²ƒ.

~~~
return "redirect:/";
~~~

## 21-2. ì¸í„°ì…‰í„°(interceptor)

- ì»¨íŠ¸ë¡¤ëŸ¬ ì‹¤í–‰ ì „/í›„ íŠ¹ì • ì‘ì—…ì„ ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ë°©ë²•

ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ë§ì€ ê²½ìš° HandlerInterceptior ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.

HandlerInterceptior(ì¸í„°í˜ì´ìŠ¤) ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ `preHandle()`(-> ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ë™í•˜ê¸° ì „ ë‹¨ê³„ì— íŠ¹ì •í•œ ì‘ì—…ì„ í•˜ê³  ì‹¶ì„ ë•Œ), `postHandle()`(-> ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‘ë™í•˜ê¸° í›„ ë‹¨ê³„ì— íŠ¹ì •í•œ ì‘ì—…ì„ í•˜ê³  ì‹¶ì„ ë•Œ), `afterCompletion()`(-> ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë·°ê°€ ë‹¤ ì‘ë™í•œ í›„ì— íŠ¹ì •í•œ ì‘ì—…ì„ í•˜ê³  ì‹¶ì„ ë•Œ) ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

ğŸ‘‰ğŸ» preHandle()ì´ ê°€ì¥ ë§ì´ ì“°ì¸ë‹¤.



# Database

## 22-1. ì˜¤ë¼í´ ë‹¤ìš´ë¡œë“œ

Oracle Database Express Edition 11g Release 2
<https://www.oracle.com/database/technologies/xe-downloads.html>

## 22-2. ì˜¤ë¼í´ ì„¤ì¹˜

## 22-3. ê³„ì • ìƒì„±

sqlplus ì—ì„œ ê³„ì •ì„ ìƒì„±í•˜ê³  ê¶Œí•œì„ ì„¤ì •í•œë‹¤.

1.scott ì´ë¼ëŠ” ê³„ì •(ì•”í˜¸ëŠ” tiger)ì„ ìƒì„±

~~~
SQL > create user scott identified by tiger;
~~~

2.ê¶Œí•œ ì„¤ì •

```
SQL > grant connect, resource to scott;
```

## 22-4. SQL developer

<https://www.oracle.com/tools/downloads/sqldev-v192-downloads.html>



# JDBC

## 23-1. ê¸°ë³¸ SQL

í…Œì´ë¸” ìƒì„± ë° ì‚­ì œí•´ë³¸ë‹¤.

## 23-2. JDBC

ë“œë¼ì´ë²„ ë¡œë”© -> DB ì—°ê²° -> SQL ì‘ì„± ë° ì „ì†¡ -> ìì›í•´ì œ

Connection, PreparedStatement, ResultSet ì‚¬ìš©




# JdbcTemplate

## 24-1. JDBC ì˜ ë‹¨ì ì„ ë³´ì™„í•œ JdbcTemplate

ë§¤ë²ˆ ë“œë¼ì´ë²„ ë¡œë”©(ë©”ëª¨ë¦¬ë¥¼ ë¡œë“œ)í•˜ê³  DBì— ì—°ê²°(connection)í•˜ê³  SQL ì‘ì„±í•˜ì—¬ ì „ì†¡í•˜ê³  ìì›ì„ í•´ì œí•˜ëŠ” ë°˜ë³µì ì¸ ì‘ì—…ì„ í•˜ëŠ”ë°,

JdbcTemplate ë¥¼ ì´ìš©í•˜ë©´ (ë“œë¼ì´ë²„ ë¡œë”©, DB ì—°ê²°, ìì›í•´ì œ)ë¥¼ ì•Œì•„ì„œ í•´ì¤€ë‹¤. 

ë”°ë¼ì„œ, ê°œë°œìëŠ” ìì‹ ì˜ ì—…ë¬´ì— ì§‘ì¤‘í•  ìˆ˜ ìˆë‹¤.

## 24-2. DataSource í´ë˜ìŠ¤

ì˜¤ë¼í´ ë ˆí¼ì§€í† ë¦¬ ì¶”ê°€, ì˜ì¡´ì„¤ì • ì¶”ê°€í•˜ì—¬ ì‚¬ìš©í•œë‹¤.
dataSource ê°ì²´ë¥¼ ìƒì„±í•´ db ì •ë³´ë¥¼ ë‹´ì•„ë‘ê³  Jdbctemplate ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©.

ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ê³¼ ê´€ë ¨ëœ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” DataSource ëŠ” ìŠ¤í”„ë§ ë˜ëŠ” c3p0 ì— ì œê³µí•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì´ìš©í•  ìˆ˜ ìˆë‹¤.

> ìŠ¤í”„ë§

org.springframework.jdbc.datasource.DriverManagerDataSource

> c3p0

com.mchange.v2.c3p0.DriverManagerDataSource


 
# ì»¤ë„¥ì…˜í’€

ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì„ ë¯¸ë¦¬ ì¤€ë¹„í•´ë†“ê³  ì‚¬ìš©í•˜ì—¬ ì„œë²„ì˜ ë¶€í•˜ë¥¼ ìµœì†Œí™”í•œë‹¤.

## 25-1. c3p0 ëª¨ë“ˆì˜ ComboPooledDataSource

~~~ 
import com.mchange.v2.c3p0.ComboPooledDataSource;
 
dataSource = new ComboPooledDataSource();
try{
    dataSource.setDriverClass(driver); 
    dataSource.setJdbcUrl(url); 
    dataSource.setUser(userid); 
    dataSource.setPassword(userpw);
} catch (PropertyVetoException e) {
    e.printStackTrace();
}
~~~

âœ… DriverManagerDataSoruce ì™€ëŠ” ë‹¤ë¥´ê²Œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ ë°˜ë“œì‹œ í•´ì¤˜ì•¼í•œë‹¤.


## 25-2. ìŠ¤í”„ë§ ì„¤ì •íŒŒì¼ì˜ ì´ìš©í•œ DataSource ì„¤ì •

> servlet-context.xml
~~~
<beans:bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"> 
    <beans:property name="driverClass" value="oracle.jdbc.driver.OracleDriver" />
    <beans:property name="jdbcUrl" value="jdbc:oracle:thin:@localhost:1521:xe" />
    <beans:property name="user" value="scott" />
    <beans:property name="password" value="tiger" /> 
    <beans:property name="maxPoolSize" value="200" /> 
    <beans:property name="checkoutTimeout" value="60000" /> <beans:property name="maxIdleTime" value="1800" /> <beans:property name="idleConnectionTestPeriod" value="600" />
</beans:bean>
~~~

> MemberDao.java
~~~
@AutoWired
public MemberDao(ComboPooledDataSource dataSource){
    this.template = new JdbcTemplate(dataSource);
}
~~~

âœ… ì½¤ë³´í’€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ë§Œë“¤ì–´ ë†“ê³  DAOì—ì„œ ìë™ ì£¼ì…í•´ì„œ ì‚¬ìš©í•œë‹¤.(ì¶”ì²œ)

xml íŒŒì¼ ëŒ€ì‹ ì— javaíŒŒì¼ì— ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•´ì„œ(@Bean) DBconfig ë”°ë¡œ ë¹¼ì„œ ì‘ì„±í•´ë„ ëœë‹¤.
